---
import HeaderLink from "./HeaderLink.astro";
import { SITE_TITLE } from "../consts";
import Search from "./Search.svelte";
import { getCollection } from "astro:content";

const props = Astro.props;

const posts =
  (await getCollection("blog")).sort(
    (a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
  ) ?? [];
---

<header
  class="bg-gradient-to-r from-purple-950/95 via-[#0a0612] to-black text-white backdrop-blur-sm"
  {...props}
>
  <nav class="max-w-7xl mx-auto">
    <a
      href="/"
      class="flex items-center gap-2 text-lg font-semibold text-transparent 
      bg-clip-text bg-gradient-to-r from-purple-500 to-purple-300 
      hover:from-purple-400 hover:to-purple-200 transition-all hover:scale-105"
    >
      <img
        src="/favicon.ico"
        alt="Logo"
        class="w-8 h-8 inline-block mr-2 rounded-full bg-pink-500 bg-opacity-20"
      />
      <h2 class="">
        {SITE_TITLE}
      </h2>
    </a>
    <div class="hidden sm:flex sm:gap-1">
      <HeaderLink href="/" alias="blog">Blog</HeaderLink>
      <HeaderLink href="/cv">About</HeaderLink>
    </div>
    <div class="flex align-center gap-2 sm:gap-4">
      <Search client:load posts={posts} />

      <button
        id="themeToggle"
        onclick="
          const newTheme = localStorage.getItem('theme') === 'dark' ? 'light' : 'dark';
          document.documentElement.classList.toggle('dark', newTheme === 'dark');
          localStorage.setItem('theme', newTheme);
        "
        type="button"
        aria-label="Toggle theme"
        aria-pressed="false"
        class="flex items-center justify-center w-8 h-8 rounded-full shadow-sm
         bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100
         transition-colors duration-200 hover:scale-105 active:scale-95
         hover:text-purple-800 dark:hover:text-purple-300"
      >
        <!-- Sun (light mode) -->
        <svg
          class="w-4 h-4 block dark:hidden"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <circle cx="12" cy="12" r="4"></circle>
          <path
            stroke-linecap="round"
            d="M12 2v2M12 20v2M4 12H2M22 12h-2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
          ></path>
        </svg>

        <!-- Moon (dark mode) -->
        <svg
          class="w-4 h-4 hidden dark:block"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 12.79A9 9 0 1 1 11.21 3
             a7 7 0 0 0 9.79 9.79Z"
          ></path>
        </svg>
      </button>

      <a
        href="https://github.com/sam-eah"
        target="_blank"
        class="flex items-center justify-center w-8 h-8 rounded-full shadow-sm
        bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100 
        transition-colors duration-200 hover:scale-105 active:scale-95 hover:text-purple-800 dark:hover:text-purple-300"
      >
        <span class="sr-only">Go to my GitHub</span>
        <svg viewBox="0 0 16 16" aria-hidden="true" width="28" height="28" class=""
          ><path
            fill="currentColor"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
          ></path></svg
        >
      </a>
    </div>
  </nav>
</header>
<style>
  header {
    margin: 0;
    padding: 0.5rem 1rem;
    position: sticky;
    z-index: 10;
    top: 0;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 3rem;
  }
</style>
